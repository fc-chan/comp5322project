import{z as A,q as H,r as h,o as S,i as d,e as s,g as o,w as l,b as C,t as n,h as x,F as k,l as I,B as w,E as u,u as V,d as r,j as K,n as y,C as O,_ as R}from"./index-CVwAxhXS.js";import{u as z}from"./user-vsJKJ1an.js";import{r as v}from"./request-DxDOYZdA.js";const F={class:"account-wrapper"},U={class:"account-layout"},W={class:"account-main"},Y={class:"section-value"},q={class:"info-row"},j={class:"info-content"},G={class:"info-value"},J={class:"info-row"},Q={class:"info-content"},X={class:"info-value"},Z={class:"info-row"},ss={class:"info-content"},es={class:"profile-text"},ts={class:"account-side"},is=["onClick"],ns={class:"invoice-main"},os={class:"invoice-text"},as={class:"invoice-company"},cs={class:"invoice-due"},ls=["src"],ds={class:"invoice-right"},rs={class:"invoice-amount"},us={class:"amount"},vs={class:"invoice-main"},ps=["onClick"],ms={class:"invoice-company"},fs={class:"invoice-right"},_s=["onClick"],ws={class:"invoice-main"},ys={class:"invoice-text"},gs={class:"invoice-company"},hs={class:"invoice-due"},Cs={class:"invoice-right"},xs={class:"invoice-amount"},ks={class:"amount"},Is=A({__name:"Profile",setup($s){const P=V(),a=z(),f=H(()=>a.user),$=h([]),b=h([]),E=h([]);async function D(i){return await v.get(`/items/${i}`)}async function T(){const i=await v.get(`/users/${a.user.id}/bids`),e=await v.get(`/users/${a.user.id}/sell-items`),c=await v.get(`/users/${a.user.id}/won-items`),_=[...new Set(i.map(t=>t.itemId))],p={};await Promise.all(_.map(async t=>{const m=await D(t);p[t]=m})),$.value=i.map(t=>({...t,item:p[t.itemId]})),b.value=e.filter(t=>t.status==="BIDDING"),E.value=c}S(T);const L=async()=>{try{const{value:i}=await w.prompt("Please input your new e-mail","Change Email",{confirmButtonText:"Next",cancelButtonText:"Cancel",inputPattern:/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/,inputErrorMessage:"Invalid Email",inputValue:""}),{value:e}=await w.prompt("Please input your password to confirm","Verify Password",{confirmButtonText:"OK",cancelButtonText:"Cancel",inputType:"password"}),c={id:a.user.id,email:i,password:e};await v.post(`/auth/${a.user.id}/credentials/edit`,c),a.user.email=i,u({type:"success",message:"Email updated successfully"})}catch(i){i==="cancel"?u({type:"info",message:"Input canceled"}):i!=="close"&&u({type:"error",message:"Update failed"})}},M=()=>{w.prompt("Please input your new password","Change Password",{confirmButtonText:"OK",cancelButtonText:"Cancel",inputType:"password"}).then(async({value:i})=>{const e={id:a.user.id,email:a.user.email,password:i};await v.post(`/auth/${a.user.id}/credentials/edit`,e),u({type:"success",message:"Password updated successfully"})}).catch(i=>{i==="cancel"?u({type:"info",message:"Input canceled"}):i!=="close"&&u({type:"error",message:"Update failed"})})};function B(i){return i?new Date(i).toLocaleString("zh-HK",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"-"}function g(i){i&&P.push(`/item/${i}`)}function N(i){i&&w.confirm("Are you sure you want to cancel this listing?","Cancel Listing",{confirmButtonText:"Yes, cancel it",cancelButtonText:"No",type:"warning"}).then(async()=>{await v.delete(`/items/${i}/cancel`),u.success("Listing cancelled"),await T()}).catch(()=>{})}return(i,e)=>{const c=C("el-card"),_=C("el-divider"),p=C("el-button");return r(),d("div",F,[s("div",U,[s("div",W,[o(c,{class:"card"},{default:l(()=>[e[1]||(e[1]=s("div",{class:"section-label"},"MY PROFILE",-1)),s("div",Y,n(f.value.username||"—"),1)]),_:1}),o(c,{class:"card"},{default:l(()=>[s("div",q,[e[3]||(e[3]=s("div",{class:"info-label"},"USERNAME",-1)),s("div",j,[s("div",G,n(f.value.username||"—"),1),e[2]||(e[2]=s("div",{class:"info-desc"},"Your username cannot be changed.",-1))])]),o(_),s("div",J,[e[6]||(e[6]=s("div",{class:"info-label"},"EMAIL",-1)),s("div",Q,[s("div",X,n(f.value.email||"—"),1),e[5]||(e[5]=s("div",{class:"info-desc"}," We'll contact you via email with updates about your bids and transactions. ",-1)),o(p,{type:"text",class:"link",onClick:e[0]||(e[0]=t=>L())},{default:l(()=>[...e[4]||(e[4]=[x("Change",-1)])]),_:1})])]),o(_),s("div",Z,[e[9]||(e[9]=s("div",{class:"info-label"},"PASSWORD",-1)),s("div",ss,[e[8]||(e[8]=s("div",{class:"info-value"},"••••••••••",-1)),o(p,{type:"text",class:"link",onClick:M},{default:l(()=>[...e[7]||(e[7]=[x("Change password",-1)])]),_:1})])])]),_:1}),o(c,{class:"card"},{default:l(()=>[e[10]||(e[10]=s("div",{class:"section-label"},"PROFILE",-1)),s("div",es,n(f.value.profile.bio||"No profile description yet."),1)]),_:1})]),s("div",ts,[o(c,{class:"invoices-card"},{default:l(()=>[e[13]||(e[13]=s("div",{class:"invoices-header"},"Bidding History",-1)),(r(!0),d(k,null,I($.value,t=>(r(),d("div",{key:t.id,class:"invoice-row"},[s("div",{class:"invoice-card clickable-card",onClick:m=>g(t.item?.id||t.itemId)},[e[12]||(e[12]=s("div",{class:"accent-bar"},null,-1)),s("div",ns,[s("div",os,[s("div",as,n(t.item?.title||t.itemId),1),s("div",cs,n(B(t.bidTimeHkt)),1),t.item?(r(),d("img",{key:0,src:`data:${t.item.imageContentType};base64,${t.item.imageData}`,style:{width:"80px"}},null,8,ls)):K("",!0)]),s("div",ds,[s("div",rs,[s("div",us,n(t.bidAmount),1),e[11]||(e[11]=s("div",{class:"currency"},"HKD",-1))])])])],8,is)]))),128))]),_:1}),o(c,{class:"invoices-card",style:{"margin-top":"20px"}},{default:l(()=>[e[16]||(e[16]=s("div",{class:"invoices-header"},"Active Listings",-1)),(r(!0),d(k,null,I(b.value,t=>(r(),d("div",{key:t.id,class:"invoice-row"},[s("div",{class:y(["invoice-card clickable-card",`accent-${t.id}`])},[e[15]||(e[15]=s("div",{class:"accent-bar"},null,-1)),s("div",vs,[s("div",{class:"invoice-text",onClick:m=>g(t.id)},[s("div",ms,n(t.title),1)],8,ps),s("div",fs,[s("div",{class:y(["status-pill",t.statusType])},n(t.status),3),o(p,{type:"danger",plain:"",size:"small",class:"cancel-btn",onClick:O(m=>N(t.id),["stop"])},{default:l(()=>[...e[14]||(e[14]=[x(" Cancel ",-1)])]),_:1},8,["onClick"])])])],2)]))),128))]),_:1}),o(c,{class:"invoices-card",style:{"margin-top":"20px"}},{default:l(()=>[e[19]||(e[19]=s("div",{class:"invoices-header"},"Won Items",-1)),(r(!0),d(k,null,I(E.value,t=>(r(),d("div",{key:t.id,class:"invoice-row"},[s("div",{class:y(["invoice-card clickable-card",`accent-${t.id}`]),onClick:m=>g(t.id)},[e[18]||(e[18]=s("div",{class:"accent-bar"},null,-1)),s("div",ws,[s("div",ys,[s("div",gs,n(t.title),1),s("div",hs,n(B(t.auctionEndHkt)),1)]),s("div",Cs,[s("div",{class:y(["status-pill",t.statusType])},n(t.status),3),s("div",xs,[s("div",ks,n(t.winnerPayAmount),1),e[17]||(e[17]=s("div",{class:"currency"},"HKD",-1))])])])],10,_s)]))),128))]),_:1})])])])}}}),Bs=R(Is,[["__scopeId","data-v-28a2991b"]]);export{Bs as default};
